# Sky Canvas æ¶æ„é‡æ„è¯´æ˜

## ğŸ¯ é‡æ„ç›®æ ‡

å°†åŸæœ¬é”™ä½çš„åº•å±‚æ¸²æŸ“åŠŸèƒ½ä»Frontend UIå±‚è¿ç§»åˆ°Render Engineå±‚ï¼Œå»ºç«‹æ¸…æ™°çš„æ¶æ„åˆ†å±‚ã€‚

## ğŸ“‹ é‡æ„å†…å®¹

### âœ… å·²å®Œæˆè¿ç§»

**ä» `src/` è¿ç§»åˆ° `packages/render-engine/src/`ï¼š**

1. **åŠ¨ç”»ç³»ç»Ÿ** (`src/animation/` â†’ `packages/render-engine/src/animation/`)
   - é«˜æ€§èƒ½å›¾å½¢åŠ¨ç”»å¼•æ“
   - å±æ€§è¡¥é—´ã€å…³é”®å¸§ã€è·¯å¾„åŠ¨ç”»
   - ç²’å­ç³»ç»Ÿã€æ—¶é—´è½´ç®¡ç†

2. **æ»¤é•œç³»ç»Ÿ** (`src/effects/` â†’ `packages/render-engine/src/effects/`)
   - WebGLç€è‰²å™¨æ»¤é•œ
   - åŸºç¡€æ»¤é•œï¼ˆæ¨¡ç³Šã€äº®åº¦ã€å¯¹æ¯”åº¦ç­‰ï¼‰
   - é«˜çº§æ•ˆæœï¼ˆé˜´å½±ã€å‘å…‰ã€è‡ªå®šä¹‰ç€è‰²å™¨ï¼‰

3. **æ–‡æœ¬ç³»ç»Ÿ** (`src/text/` + `packages/render-engine/src/text/` åˆå¹¶)
   - å­—ä½“åŠ è½½ç®¡ç†ï¼ˆFontManager, FontLoaderï¼‰
   - å¯Œæ–‡æœ¬è§£æå’Œæ¸²æŸ“ï¼ˆRichTextParser, RichTextRendererï¼‰
   - å›½é™…åŒ–æ–‡æœ¬æ”¯æŒï¼ˆI18nTextManager, BidiProcessorï¼‰

### âœ… Canvas SDK æ¶æ„é‡æ„

**é‡æ„ç›®æ ‡**ï¼šå»ºç«‹æ¸…æ™°çš„ MVVM + Manager æ¶æ„æ¨¡å¼

4. **äº‹ä»¶ç³»ç»Ÿé‡æ„** (`packages/canvas-sdk/src/events/` â†’ åˆ é™¤é‡å¤)
   - åˆ é™¤ä¸ `services/eventBus/` é‡å¤çš„äº‹ä»¶æ¨¡å—
   - ä½¿ç”¨ EventEmitter3 æ ‡å‡†åº“æ›¿ä»£è‡ªå®šä¹‰å®ç°
   - ç»Ÿä¸€äº‹ä»¶å¤„ç†æ¶æ„

5. **å†å²ç³»ç»Ÿé‡æ„** (`packages/canvas-sdk/src/history/` â†’ `services/history/` + `managers/TransactionManager`)
   - åˆ é™¤é‡å¤çš„ HistoryManagerï¼Œä¿ç•™åŠŸèƒ½æ›´å®Œæ•´çš„ HistoryService
   - å°†å‘½ä»¤å®ç°æ•´åˆåˆ° `services/history/commands.ts`
   - å°†äº‹åŠ¡ç³»ç»Ÿé‡æ„ä¸º `managers/TransactionManager.ts`
   - æ”¯æŒåµŒå¥—äº‹åŠ¡ã€æ‰¹é‡æ“ä½œå’Œè£…é¥°å™¨æ¨¡å¼

## ğŸ—ï¸ æ–°çš„æ¶æ„åˆ†å±‚

### 1ï¸âƒ£ Render Engine (`packages/render-engine/`)
**èŒè´£**ï¼šæ¡†æ¶æ— å…³çš„åº•å±‚å›¾å½¢æ¸²æŸ“åŠŸèƒ½

- âœ… **æ ¸å¿ƒæ¸²æŸ“ç®¡é“**ï¼šWebGL/Canvas2D/WebGPUé€‚é…å™¨
- âœ… **æ‰¹å¤„ç†ä¼˜åŒ–**ï¼šæ™ºèƒ½åˆ†ç»„ã€å®ä¾‹åŒ–æ¸²æŸ“ã€çº¹ç†å›¾é›†
- âœ… **æ•°å­¦å’Œå‡ ä½•è¿ç®—**ï¼šå‘é‡ã€çŸ©é˜µã€ç¢°æ’æ£€æµ‹
- âœ… **èµ„æºç®¡ç†**ï¼šçº¹ç†ã€ç€è‰²å™¨ã€å­—ä½“èµ„æº
- âœ… **é«˜æ€§èƒ½åŠ¨ç”»å¼•æ“**ï¼šè¡¥é—´ã€å…³é”®å¸§ã€ç²’å­ç³»ç»Ÿ
- âœ… **WebGLæ»¤é•œç³»ç»Ÿ**ï¼šç€è‰²å™¨æ»¤é•œã€åå¤„ç†ç®¡é“
- âœ… **æ–‡æœ¬æ¸²æŸ“**ï¼šå­—ä½“ç®¡ç†ã€å¯Œæ–‡æœ¬ã€å›½é™…åŒ–
- âœ… **æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼šæ¸²æŸ“æ€§èƒ½åˆ†æ

### 2ï¸âƒ£ Canvas SDK (`packages/canvas-sdk/`)  
**èŒè´£**ï¼šç”»å¸ƒä¸šåŠ¡é€»è¾‘å’Œäº¤äº’ç®¡ç†

- âœ… **MVVM + Manager æ¶æ„**ï¼šServiceï¼ˆå•ä¸€èŒè´£ï¼‰â†’ Managerï¼ˆä¸šåŠ¡åè°ƒï¼‰â†’ ViewModelï¼ˆçŠ¶æ€ç®¡ç†ï¼‰
- âœ… **åº”ç”¨çº§æœåŠ¡**ï¼šé€‰æ‹©ã€å†å²ã€å›¾å±‚ã€å·¥å…·ç®¡ç†
- âœ… **äº‹åŠ¡å’Œå‘½ä»¤ç³»ç»Ÿ**ï¼šæ”¯æŒæ’¤é”€é‡åšã€æ‰¹é‡æ“ä½œã€åµŒå¥—äº‹åŠ¡
- âœ… **äº‹ä»¶æ€»çº¿ç³»ç»Ÿ**ï¼šç»Ÿä¸€çš„äº‹ä»¶å¤„ç†å’Œä¾èµ–æ³¨å…¥
- âœ… **å·¥å…·ç³»ç»Ÿ**ï¼šç»˜åˆ¶å·¥å…·ã€é€‰æ‹©å·¥å…·ã€äº¤äº’é€»è¾‘
- âœ… **æ’ä»¶æ¶æ„**ï¼šæ‰©å±•æœºåˆ¶ã€AIé›†æˆ
- âœ… **å“åº”å¼çŠ¶æ€ç®¡ç†**ï¼šValtioæ•°æ®ç»‘å®š
- ğŸ”„ **Render Engineé›†æˆ**ï¼šé€‚é…å™¨æ¨¡å¼è®¿é—®åº•å±‚åŠŸèƒ½

### 3ï¸âƒ£ Frontend UI (`src/`)
**èŒè´£**ï¼šçº¯React UIç»„ä»¶å±‚

- âœ… **Reactç»„ä»¶**ï¼šç•Œé¢ç»„ä»¶ã€å¸ƒå±€ç®¡ç†  
- âœ… **UIçŠ¶æ€ç®¡ç†**ï¼šZustandçŠ¶æ€ç®¡ç†
- âœ… **ç”¨æˆ·äº¤äº’**ï¼šé¼ æ ‡ã€é”®ç›˜äº‹ä»¶å¤„ç†
- âœ… **Canvas SDKé›†æˆ**ï¼šé€šè¿‡hooksä½¿ç”¨SDK API
- ğŸ†• **Render Engineé€‚é…å™¨**ï¼šè®¿é—®åº•å±‚æ¸²æŸ“åŠŸèƒ½

## ğŸ”— ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ

### Frontend UI â†’ Canvas SDK â†’ Render Engine

```
Frontend UI (React)
    â†“ hooks/contexts
Canvas SDK (Business Logic)
    â†“ adapters  
Render Engine (Graphics Core)
```

### åŠ¨ç”»ç³»ç»Ÿåˆ†å·¥

- **Render EngineåŠ¨ç”»**ï¼šé«˜æ€§èƒ½å›¾å½¢åŠ¨ç”»ï¼ˆå½¢çŠ¶å˜å½¢ã€ç²’å­æ•ˆæœï¼‰
- **Canvas SDKåŠ¨ç”»**ï¼šåº”ç”¨çº§åŠ¨ç”»ï¼ˆå·¥å…·åˆ‡æ¢ã€UIåé¦ˆï¼‰
- **Frontend UIåŠ¨ç”»**ï¼šç•Œé¢åŠ¨ç”»ï¼ˆç»„ä»¶è¿‡æ¸¡ã€ç”¨æˆ·äº¤äº’ï¼‰

### æ–‡æœ¬ç³»ç»Ÿåˆ†å·¥

- **Render Engineæ–‡æœ¬**ï¼šå­—ä½“åŠ è½½ã€å¯Œæ–‡æœ¬æ¸²æŸ“ã€å›½é™…åŒ–å¸ƒå±€
- **Canvas SDKæ–‡æœ¬**ï¼šæ–‡æœ¬å·¥å…·ã€ç¼–è¾‘é€»è¾‘ã€æ ¼å¼ç®¡ç†
- **Frontend UIæ–‡æœ¬**ï¼šæ–‡æœ¬è¾“å…¥ç»„ä»¶ã€ç¼–è¾‘ç•Œé¢

### æ»¤é•œç³»ç»Ÿåˆ†å·¥  

- **Render Engineæ»¤é•œ**ï¼šWebGLç€è‰²å™¨ã€å›¾åƒå¤„ç†ç®—æ³•
- **Canvas SDKæ»¤é•œ**ï¼šæ»¤é•œåº”ç”¨é€»è¾‘ã€é¢„è®¾ç®¡ç†
- **Frontend UIæ»¤é•œ**ï¼šæ»¤é•œé€‰æ‹©ç•Œé¢ã€å‚æ•°è°ƒèŠ‚

## ğŸ“¦ å¯¼å‡ºç­–ç•¥

### Render Engineå¯¼å‡º
```typescript
// åº•å±‚å›¾å½¢åŠŸèƒ½
export * from './animation/index';    // TODO: ä¿®å¤åå¯ç”¨
export * from './effects/index';      // TODO: ä¿®å¤åå¯ç”¨  
export * from './text/index';         // âœ… å·²å¯ç”¨
export * from './math/index';         // âœ… æ•°å­¦åº“
export * from './performance/index';  // âœ… æ€§èƒ½ç›‘æ§
```

### Canvas SDKå¯¼å‡º
```typescript
// MVVM + Manager æ¶æ„
export * from './services/index';     // âœ… å•ä¸€èŒè´£æœåŠ¡
export * from './managers/index';     // âœ… ä¸šåŠ¡åè°ƒç®¡ç†å™¨
export * from './viewmodels/index';   // âœ… å“åº”å¼çŠ¶æ€ç®¡ç†
export * from './models/index';       // âœ… æ•°æ®æ¨¡å‹
export * from './views/index';        // âœ… æ¸²æŸ“è§†å›¾

// å†å²å’Œäº‹åŠ¡ç³»ç»Ÿ
export * from './services/history';   // âœ… å†å²æœåŠ¡å’Œå‘½ä»¤
export * from './managers/TransactionManager'; // âœ… äº‹åŠ¡ç®¡ç†

// ä¾èµ–æ³¨å…¥
export * from './di/index';           // âœ… ä¾èµ–æ³¨å…¥å®¹å™¨
```

### Frontend UIå¯¼å‡º  
```typescript
// UIç»„ä»¶å’Œé€‚é…å™¨
export * from './components/index';   // âœ… Reactç»„ä»¶
export * from './hooks/index';        // âœ… è‡ªå®šä¹‰hooks
export * from './adapters/index';     // ğŸ†• åº•å±‚åŠŸèƒ½é€‚é…å™¨
```

## ğŸ”„ å¾…è§£å†³é—®é¢˜

1. **ç±»å‹å…¼å®¹æ€§**ï¼šè¿ç§»çš„æ¨¡å—å­˜åœ¨ç±»å‹é”™è¯¯
2. **ä¾èµ–å…³ç³»**ï¼šéœ€è¦æ¸…ç†å¾ªç¯ä¾èµ–å’Œå†²çª
3. **æµ‹è¯•æ›´æ–°**ï¼šæ›´æ–°ç›¸å…³çš„æµ‹è¯•æ–‡ä»¶è·¯å¾„
4. **æ–‡æ¡£æ›´æ–°**ï¼šæ›´æ–°APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

## âœ… å·²å®Œæˆçš„æ¶æ„æ¸…ç†

### Canvas SDK é‡å¤æ¨¡å—æ¸…ç†

1. **events/ ç›®å½•é‡å¤æ¸…ç†**
   - âŒ åˆ é™¤ï¼š`packages/canvas-sdk/src/events/` 
   - âœ… ä¿ç•™ï¼š`packages/canvas-sdk/src/services/eventBus/` 
   - ğŸ”§ æ”¹è¿›ï¼šä½¿ç”¨ EventEmitter3 æ ‡å‡†åº“

2. **history/ ç›®å½•é‡å¤æ¸…ç†**  
   - âŒ åˆ é™¤ï¼š`packages/canvas-sdk/src/history/HistoryManager.ts`ï¼ˆåŠŸèƒ½é‡å¤ï¼‰
   - âœ… ä¿ç•™ï¼š`packages/canvas-sdk/src/services/history/historyService.ts`ï¼ˆæ›´å®Œæ•´ï¼‰
   - ğŸ”„ é‡æ„ï¼š`history/Commands.ts` â†’ `services/history/commands.ts`
   - ğŸ”„ é‡æ„ï¼š`history/Transaction.ts` â†’ `managers/TransactionManager.ts`

### æ¶æ„æ¨¡å¼ç»Ÿä¸€

- **Service å±‚**ï¼šå•ä¸€èŒè´£ï¼Œæ”¯æŒä¾èµ–æ³¨å…¥ï¼Œé›†æˆäº‹ä»¶æ€»çº¿å’Œæ—¥å¿—
- **Manager å±‚**ï¼šä¸šåŠ¡åè°ƒï¼Œå¤„ç†å¤æ‚é€»è¾‘ï¼Œåè°ƒå¤šä¸ª Services  
- **ViewModel å±‚**ï¼šå“åº”å¼çŠ¶æ€ç®¡ç†ï¼Œç®€å•åœºæ™¯ç›´æ¥ä½¿ç”¨ Serviceï¼Œå¤æ‚åœºæ™¯ä½¿ç”¨ Manager
- **View å±‚**ï¼šçº¯æ¸²æŸ“é€»è¾‘ï¼Œå°† Model è½¬æ¢ä¸ºå¯æ¸²æŸ“å¯¹è±¡

## ğŸ‰ é¢„æœŸæ”¶ç›Š

### æ¶æ„å±‚é¢
- **èŒè´£æ¸…æ™°**ï¼šæ¯å±‚ä¸“æ³¨è‡ªå·±çš„æ ¸å¿ƒåŠŸèƒ½
- **å¤ç”¨æ€§å¼º**ï¼šåº•å±‚åŠŸèƒ½å¯è¢«å¤šä¸ªåº”ç”¨ä½¿ç”¨
- **æ€§èƒ½ä¼˜åŒ–**ï¼šä¸“ä¸šçš„å›¾å½¢æ¸²æŸ“ä¼˜åŒ–
- **ç»´æŠ¤ç®€å•**ï¼šåˆ†å±‚å¼€å‘ï¼Œç‹¬ç«‹æµ‹è¯•
- **æ‰©å±•æ€§å¥½**ï¼šæ–°åŠŸèƒ½æœ‰æ˜ç¡®çš„å½’å±å±‚çº§

### Canvas SDK æ¶æ„æ”¶ç›Š
- **ä»£ç é‡å¤æ¶ˆé™¤**ï¼šåˆ é™¤äº† events/ å’Œ history/ ç›®å½•ä¸­çš„é‡å¤ä»£ç 
- **æ¶æ„æ¨¡å¼ç»Ÿä¸€**ï¼šå»ºç«‹äº†æ¸…æ™°çš„ Service â†’ Manager â†’ ViewModel â†’ View åˆ†å±‚
- **ä¾èµ–æ³¨å…¥æ”¯æŒ**ï¼šæ‰€æœ‰æœåŠ¡æ”¯æŒ DIï¼Œæé«˜å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§
- **å“åº”å¼çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨ Valtio å®ç°è‡ªåŠ¨ UI æ›´æ–°
- **æ ‡å‡†åŒ–äº‹ä»¶å¤„ç†**ï¼šä½¿ç”¨ EventEmitter3 å’Œäº‹ä»¶æ€»çº¿ç»Ÿä¸€äº‹ä»¶æœºåˆ¶
- **å¼ºç±»å‹æ”¯æŒ**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰å’Œç¼–è¯‘æ—¶æ£€æŸ¥

---

*æ¶æ„é‡æ„å®Œæˆåï¼ŒSky Canvaså°†æ‹¥æœ‰æ›´æ¸…æ™°çš„åˆ†å±‚ç»“æ„ï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å’Œæ€§èƒ½ä¼˜åŒ–å¥ å®šåšå®åŸºç¡€ã€‚*