<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sky Canvas ç³»ç»Ÿæ¶æ„æ¼”ç¤º</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .demo-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .canvas-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    
    #renderCanvas {
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }
    
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .info-panel {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    
    .info-box {
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }
    
    .info-box h3 {
      margin-top: 0;
      color: #4CAF50;
    }
    
    .stats {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.4;
    }
    
    .log-output {
      background: rgba(0, 0, 0, 0.4);
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ Sky Canvas ç³»ç»Ÿæ¶æ„æ¼”ç¤º</h1>
    
    <div class="demo-section">
      <h2>æ¸²æŸ“ç”»å¸ƒ</h2>
      <div class="canvas-container">
        <canvas id="renderCanvas" width="800" height="600"></canvas>
      </div>
      
      <div class="controls">
        <button id="initBtn">åˆå§‹åŒ–ç³»ç»Ÿ</button>
        <button id="startBtn" disabled>å¼€å§‹æ¸²æŸ“</button>
        <button id="stopBtn" disabled>åœæ­¢æ¸²æŸ“</button>
        <button id="statsBtn" disabled>æ˜¾ç¤ºç»Ÿè®¡</button>
        <button id="destroyBtn" disabled>é”€æ¯ç³»ç»Ÿ</button>
      </div>
    </div>
    
    <div class="info-panel">
      <div class="info-box">
        <h3>ç³»ç»Ÿä¿¡æ¯</h3>
        <div id="systemInfo" class="stats">
          ç­‰å¾…åˆå§‹åŒ–...
        </div>
      </div>
      
      <div class="info-box">
        <h3>æ€§èƒ½ç»Ÿè®¡</h3>
        <div id="performanceStats" class="stats">
          ç­‰å¾…å¼€å§‹æ¸²æŸ“...
        </div>
      </div>
    </div>
    
    <div class="demo-section">
      <h3>æ§åˆ¶å°æ—¥å¿—</h3>
      <div id="logOutput" class="log-output">
        ç³»ç»Ÿå‡†å¤‡å°±ç»ªï¼Œç‚¹å‡»"åˆå§‹åŒ–ç³»ç»Ÿ"å¼€å§‹...
      </div>
    </div>
  </div>

  <script type="module">
    import { SystemArchitectureDemo } from './system-architecture-demo.ts';
    
    let demo = null;
    let isRunning = false;
    
    // è·å–DOMå…ƒç´ 
    const canvas = document.getElementById('renderCanvas');
    const initBtn = document.getElementById('initBtn');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const statsBtn = document.getElementById('statsBtn');
    const destroyBtn = document.getElementById('destroyBtn');
    const systemInfo = document.getElementById('systemInfo');
    const performanceStats = document.getElementById('performanceStats');
    const logOutput = document.getElementById('logOutput');
    
    // é‡å†™console.logä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      const message = args.map(arg => 
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
      ).join(' ');
      logOutput.innerHTML += message + '\n';
      logOutput.scrollTop = logOutput.scrollHeight;
    };
    
    // åˆå§‹åŒ–ç³»ç»Ÿ
    initBtn.addEventListener('click', async () => {
      try {
        logOutput.innerHTML = '';
        console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ– Sky Canvas ç³»ç»Ÿæ¶æ„æ¼”ç¤º...');
        
        demo = new SystemArchitectureDemo(canvas);
        await demo.initialize();
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        initBtn.disabled = true;
        startBtn.disabled = false;
        destroyBtn.disabled = false;
        
        // æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
        systemInfo.innerHTML = `
          âœ… æ¸²æŸ“å¼•æ“: å·²åˆå§‹åŒ–<br>
          âœ… ç³»ç»Ÿç®¡ç†å™¨: å·²åŠ è½½<br>
          âœ… æ‰©å±•ç®¡ç†å™¨: å·²åŠ è½½<br>
          âœ… æ¶æ„ç®¡ç†å™¨: å·²åŠ è½½<br>
          ğŸ“Š ç³»ç»Ÿæ•°é‡: 4ä¸ªæ ¸å¿ƒç³»ç»Ÿ
        `;
        
        console.log('âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼');
      } catch (error) {
        console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error.message);
      }
    });
    
    // å¼€å§‹æ¸²æŸ“
    startBtn.addEventListener('click', () => {
      if (demo && !isRunning) {
        console.log('ğŸ¬ å¼€å§‹æ¸²æŸ“å¾ªç¯...');
        demo.startRender();
        isRunning = true;
        
        startBtn.disabled = true;
        stopBtn.disabled = false;
        statsBtn.disabled = false;
        
        // å¼€å§‹æ€§èƒ½ç›‘æ§
        startPerformanceMonitoring();
      }
    });
    
    // åœæ­¢æ¸²æŸ“
    stopBtn.addEventListener('click', () => {
      if (demo && isRunning) {
        console.log('â¹ï¸ åœæ­¢æ¸²æŸ“å¾ªç¯...');
        demo.stopRender();
        isRunning = false;
        
        startBtn.disabled = false;
        stopBtn.disabled = true;
        statsBtn.disabled = true;
      }
    });
    
    // æ˜¾ç¤ºç»Ÿè®¡
    statsBtn.addEventListener('click', () => {
      if (demo) {
        console.log('ğŸ“Š æ˜¾ç¤ºæ€§èƒ½ç»Ÿè®¡...');
        demo.showStats();
      }
    });
    
    // é”€æ¯ç³»ç»Ÿ
    destroyBtn.addEventListener('click', () => {
      if (demo) {
        console.log('ğŸ—‘ï¸ é”€æ¯ç³»ç»Ÿ...');
        demo.destroy();
        demo = null;
        isRunning = false;
        
        // é‡ç½®æŒ‰é’®çŠ¶æ€
        initBtn.disabled = false;
        startBtn.disabled = true;
        stopBtn.disabled = true;
        statsBtn.disabled = true;
        destroyBtn.disabled = true;
        
        // æ¸…ç©ºä¿¡æ¯
        systemInfo.innerHTML = 'ç­‰å¾…åˆå§‹åŒ–...';
        performanceStats.innerHTML = 'ç­‰å¾…å¼€å§‹æ¸²æŸ“...';
        
        console.log('âœ… ç³»ç»Ÿå·²é”€æ¯');
      }
    });
    
    // æ€§èƒ½ç›‘æ§
    function startPerformanceMonitoring() {
      const updateStats = () => {
        if (isRunning && demo) {
          const now = performance.now();
          const fps = Math.round(1000 / 16.67); // æ¨¡æ‹ŸFPS
          const memory = performance.memory ? 
            `${Math.round(performance.memory.usedJSHeapSize / 1024 / 1024)}MB` : 'N/A';
          
          performanceStats.innerHTML = `
            ğŸ¯ FPS: ${fps}<br>
            â±ï¸ æ—¶é—´: ${Math.round(now)}ms<br>
            ğŸ’¾ å†…å­˜: ${memory}<br>
            ğŸ”„ çŠ¶æ€: è¿è¡Œä¸­<br>
            ğŸ¨ æ¸²æŸ“å™¨: WebGL
          `;
          
          if (isRunning) {
            requestAnimationFrame(updateStats);
          }
        }
      };
      
      requestAnimationFrame(updateStats);
    }
    
    console.log('ğŸ® Sky Canvas æ¼”ç¤ºé¡µé¢å·²åŠ è½½');
    console.log('ğŸ‘† ç‚¹å‡»"åˆå§‹åŒ–ç³»ç»Ÿ"æŒ‰é’®å¼€å§‹ä½“éªŒ');
  </script>
</body>
</html>